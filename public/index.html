<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ImageMagick 图像处理服务控制台</title>
  <!-- Semantic UI CSS -->
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/semantic-ui/2.5.0/semantic.min.css">
  <!-- jQuery (Semantic UI 依赖) -->
  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!-- Vue 3 & axios CDN -->
  <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.3.4/vue.global.js"></script>
  <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.7.7/axios.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      font-size: 13px;
    }
    .app-layout {
      display: flex;
      min-height: 100vh;
    }
    .sidebar {
      width: 220px;
      background: #1b1c1d;
      color: #fff;
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      overflow-y: auto;
      z-index: 1000;
    }
    .sidebar-header {
      padding: 1rem 0.75rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .sidebar-header h2 {
      color: #fff;
      margin: 0;
      font-size: 1rem;
    }
    .sidebar-menu {
      padding: 0.5rem 0;
    }
    .menu-item {
      padding: 0.75rem 1rem;
      cursor: pointer;
      transition: background-color 0.2s;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: rgba(255, 255, 255, 0.8);
      border-left: 3px solid transparent;
    }
    .menu-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: #fff;
    }
    .menu-item.active {
      background-color: rgba(33, 133, 208, 0.2);
      color: #fff;
      border-left-color: #2185d0;
    }
    .menu-item i {
      width: 20px;
      text-align: center;
    }
    .main-content {
      flex: 1;
      margin-left: 220px;
      margin-right: 360px;
      padding: 1rem 1.5rem;
    }
    .section {
      margin-bottom: 2rem;
    }
    .debug-panel {
      width: 360px;
      background: #fff;
      position: fixed;
      right: 0;
      top: 0;
      bottom: 0;
      overflow-y: auto;
      z-index: 999;
      border-left: 1px solid #e0e0e0;
      box-shadow: -2px 0 4px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
    }
    .debug-panel-header {
      padding: 1rem;
      border-bottom: 1px solid #e0e0e0;
      background: #f9f9f9;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .debug-panel-content {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
    }
    .debug-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      border-bottom: 1px solid #e0e0e0;
      padding-bottom: 0.5rem;
    }
    .debug-tab {
      padding: 0.4rem 0.8rem;
      cursor: pointer;
      border-radius: 4px;
      font-size: 0.85em;
      transition: background-color 0.2s;
      color: #666;
    }
    .debug-tab:hover {
      background-color: #f0f0f0;
    }
    .debug-tab.active {
      background-color: #2185d0;
      color: #fff;
    }
    .debug-log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 0.75rem;
      border-radius: 4px;
      font-family: "Consolas", "Monaco", "Courier New", monospace;
      font-size: 0.75rem;
      white-space: pre-wrap;
      word-wrap: break-word;
      max-height: calc(100vh - 280px);
      overflow-y: auto;
    }
    .debug-log-item {
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .debug-log-item:last-child {
      border-bottom: none;
    }
    .debug-log-time {
      color: #888;
      font-size: 0.7em;
      margin-bottom: 0.25rem;
    }
    .debug-log-content {
      color: #d4d4d4;
    }
    .debug-log-content.error {
      color: #f44336;
    }
    .debug-log-content.success {
      color: #4caf50;
    }
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.9em;
    }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #999;
    }
    .status-dot.ok {
      background: #21ba45;
    }
    .status-dot.fail {
      background: #db2828;
    }
    .form-field {
      display: flex;
      flex-direction: column;
    }
    .form-field label {
      margin-bottom: 0.4rem;
      font-weight: 500;
      color: rgba(0, 0, 0, 0.87);
      font-size: 0.9em;
    }
    .ui.header {
      font-size: 1.15em;
    }
    .ui.header .sub.header {
      font-size: 0.85em;
    }
    .ui.segment {
      padding: 0.875rem;
    }
    .ui.segment h3 {
      font-size: 1.1em;
      margin-bottom: 0.75rem;
    }
    .ui.button {
      font-size: 0.9em;
      padding: 0.6em 1em;
    }
    .ui.input input,
    .ui.input textarea,
    .ui.dropdown {
      font-size: 0.9em;
    }
    .view-container {
      display: none;
    }
    .view-container.active {
      display: block;
    }
    .image-preview {
      max-width: 100%;
      max-height: 400px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin: 1rem 0;
    }
    .upload-area {
      border: 2px dashed #2185d0;
      border-radius: 6px;
      padding: 1rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: #f9f9f9;
    }
    .upload-area:hover {
      border-color: #1678c2;
      background: #f0f0f0;
    }
    .upload-area.dragover {
      border-color: #1678c2;
      background: #e8f4f8;
    }
    .upload-area i {
      font-size: 2em !important;
      margin-bottom: 0.5rem !important;
    }
    .upload-area p {
      margin: 0.25rem 0 !important;
      font-size: 0.9em !important;
    }
    .compact-form {
      margin-bottom: 1rem;
    }
    .compact-form h4 {
      font-size: 0.95em;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #e0e0e0;
    }
    .compact-form .field {
      margin-bottom: 0.75rem;
    }
    .compact-form .field:last-child {
      margin-bottom: 0.5rem;
    }
    .compact-segment {
      padding: 0.75rem !important;
      margin-bottom: 1rem !important;
    }
    .compact-segment h3 {
      font-size: 1em !important;
      margin-bottom: 0.75rem !important;
    }
    .image-preview {
      max-width: 100%;
      max-height: 250px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin: 0.5rem 0;
    }
    .image-comparison-container {
      display: flex;
      gap: 1rem;
      align-items: flex-start;
    }
    .image-comparison-item {
      flex: 1;
      text-align: center;
    }
    .image-comparison-item img {
      width: 100%;
      height: auto;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .compact-grid {
      margin: 0.5rem 0 !important;
    }
    .compact-grid .column {
      padding: 0.5rem !important;
    }
    .compact-card {
      margin: 0 !important;
    }
    .compact-card .content {
      padding: 0.75rem !important;
    }
    .compact-card .header {
      font-size: 0.9em !important;
      margin-bottom: 0.5rem !important;
    }
    .compact-list .item {
      padding: 0.5rem 0 !important;
    }
    .compact-list .item .header {
      font-size: 0.85em !important;
    }
    .compact-list .item .description {
      font-size: 0.8em !important;
    }
    .collapsible-section {
      margin-bottom: 0.75rem;
    }
    .collapsible-header {
      cursor: pointer;
      padding: 0.5rem;
      background: #f5f5f5;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: background 0.2s;
    }
    .collapsible-header:hover {
      background: #e8e8e8;
    }
    .collapsible-header i {
      transition: transform 0.3s;
    }
    .collapsible-header.collapsed i {
      transform: rotate(-90deg);
    }
    .collapsible-content {
      padding: 0.75rem;
      border-top: 1px solid #e0e0e0;
    }
    .collapsible-content.collapsed {
      display: none;
    }
    .code-output {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 0.75rem;
      border-radius: 4px;
      font-family: "Consolas", "Monaco", "Courier New", monospace;
      font-size: 0.75rem;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    @media (max-width: 1200px) {
      .debug-panel {
        display: none;
      }
      .main-content {
        margin-right: 0;
      }
    }
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s;
      }
      .sidebar.open {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="app-layout">
      <!-- 左侧菜单 -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <h2>
            <i class="image icon"></i>
            ImageMagick 服务
          </h2>
        </div>
        <div class="sidebar-menu">
          <div 
            v-for="item in menuItems" 
            :key="item.id"
            class="menu-item"
            :class="{ active: state.currentView === item.id }"
            @click="switchView(item.id)"
          >
            <i :class="item.icon + ' icon'"></i>
            <span>{{ item.name }}</span>
          </div>
        </div>
      </aside>

      <!-- 右侧主体内容 -->
      <main class="main-content">
        <!-- 首页/使用指南 -->
        <div class="view-container" :class="{ active: state.currentView === 'home' }">
          <div class="section">
            <h1 class="ui header">
              <i class="book icon"></i>
              <div class="content">
                使用指南
                <div class="sub header">了解如何使用 ImageMagick 图像处理服务</div>
              </div>
            </h1>

            <div class="ui two column grid">
              <div class="column">
                <div class="ui segment">
                  <h3 class="ui header">操作步骤</h3>
                  <ol class="ui list">
                    <li>先进行健康检查，确认 ImageMagick 已安装。</li>
                    <li>上传图片文件（支持拖拽上传）。</li>
                    <li>选择需要的操作（调整大小、裁剪、旋转等）。</li>
                    <li>设置参数并执行操作。</li>
                    <li>查看处理结果并下载。</li>
                  </ol>
                </div>
              </div>
              <div class="column">
                <div class="ui segment">
                  <h3 class="ui header">注意事项</h3>
                  <ul class="ui list">
                    <li>确保 ImageMagick 已正确安装并在系统 PATH 中</li>
                    <li>支持格式：JPG, PNG, GIF, BMP, WEBP, SVG, TIFF</li>
                    <li>上传文件大小限制：100MB</li>
                    <li>处理后的文件保存在 output 目录</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 服务配置 -->
        <div class="view-container" :class="{ active: state.currentView === 'config' }">
          <div class="section">
            <h1 class="ui header">
              <i class="cog icon"></i>
              <div class="content">
                服务配置
                <div class="sub header">配置服务和检测 ImageMagick 状态</div>
              </div>
            </h1>

            <div class="ui segment">
              <h3 class="ui dividing header">服务操作</h3>
              <div class="ui small buttons">
                <button class="ui small button" :class="{ loading: state.loading.health }" @click="checkHealth" :disabled="state.loading.health">
                  健康检查
                </button>
                <button class="ui small primary button" :class="{ loading: state.loading.checkIm }" @click="checkImageMagick" :disabled="state.loading.checkIm">
                  检测 ImageMagick
                </button>
              </div>
              <div style="margin-top: 1rem;">
                <span class="status-indicator">
                  <span class="status-dot" :class="{'ok': state.healthOk, 'fail': state.healthOk === false}"></span>
                  <span>健康状态：{{ state.healthOk === null ? '未知' : (state.healthOk ? '正常' : '异常') }}</span>
                </span>
                <div v-if="state.imagemagickStatus" style="margin-top: 0.5rem;">
                  <span class="status-indicator">
                    <span class="status-dot" :class="{'ok': state.imagemagickStatus.installed, 'fail': !state.imagemagickStatus.installed}"></span>
                    <span>{{ state.imagemagickStatus.message }}</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 图片分析 -->
        <div class="view-container" :class="{ active: state.currentView === 'analyze' }">
          <div class="section">
            <h1 class="ui header">
              <i class="search icon"></i>
              <div class="content">
                图片分析
                <div class="sub header">上传图片并查看详细信息</div>
              </div>
            </h1>

            <!-- 上传区域 -->
            <div class="ui segment compact-segment">
              <h3 class="ui dividing header" style="font-size: 0.95em; margin-bottom: 0.75rem;">上传图片</h3>
              
              <!-- 统一输入框 -->
              <div class="ui form">
                <div class="field" style="margin-bottom: 0.75rem;">
                  <label style="font-size: 0.85em; margin-bottom: 0.25rem;">图片地址（网络 URL 或选择本地文件）</label>
                  <div class="ui action input" style="font-size: 0.9em;">
                    <input type="text" v-model="state.analyzeImageUrl" placeholder="输入网络图片 URL" @keyup.enter="handleAnalyzeUrlUpload" style="font-size: 0.9em;">
                    <button class="ui primary button" :class="{ loading: state.loading.analyzeUrlUpload }" @click="handleAnalyzeUrlUpload" :disabled="!state.analyzeImageUrl || state.loading.analyzeUrlUpload" style="font-size: 0.85em; padding: 0.5em 0.75em;">
                      <i class="download icon"></i> 加载
                    </button>
                  </div>
                  <p style="color: #999; font-size: 0.8em; margin-top: 0.5rem;">支持 JPG, PNG, GIF, BMP, WEBP, SVG, TIFF</p>
                </div>
              </div>
            </div>

            <!-- 图片预览和信息 -->
            <div v-if="state.analyzeImage || state.analyzeImageInfo" class="ui segment compact-segment">
              <h3 class="ui dividing header" style="font-size: 0.95em; margin-bottom: 0.75rem;">图片信息</h3>
              
              <!-- 图片预览 -->
              <div v-if="state.analyzeImage" style="text-align: center; margin-bottom: 0.75rem;">
                <img :src="state.analyzeImage" class="image-preview" alt="分析图片">
              </div>

              <!-- 详细信息 -->
              <div v-if="state.analyzeImageInfo" class="ui two column grid compact-grid">
                <div class="column">
                  <div class="ui card compact-card">
                    <div class="content">
                      <div class="header">基本信息</div>
                      <div class="description" style="margin-top: 0.5rem;">
                        <div class="ui relaxed list compact-list">
                          <div class="item">
                            <i class="file image icon" style="font-size: 0.9em;"></i>
                            <div class="content">
                              <div class="header">格式</div>
                              <div class="description">{{ state.analyzeImageInfo.format || '未知' }}</div>
                            </div>
                          </div>
                          <div class="item">
                            <i class="expand arrows alternate icon" style="font-size: 0.9em;"></i>
                            <div class="content">
                              <div class="header">尺寸</div>
                              <div class="description">
                                {{ state.analyzeImageInfo.width || 0 }} × {{ state.analyzeImageInfo.height || 0 }} px
                              </div>
                            </div>
                          </div>
                          <div class="item">
                            <i class="hdd icon" style="font-size: 0.9em;"></i>
                            <div class="content">
                              <div class="header">文件大小</div>
                              <div class="description">{{ formatFileSize(state.analyzeImageInfo.size || 0) }}</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="column">
                  <div class="ui card compact-card">
                    <div class="content">
                      <div class="header">技术信息</div>
                      <div class="description" style="margin-top: 0.5rem;">
                        <div class="ui relaxed list compact-list">
                          <div class="item">
                            <i class="palette icon" style="font-size: 0.9em;"></i>
                            <div class="content">
                              <div class="header">颜色空间</div>
                              <div class="description">{{ state.analyzeImageInfo.colorspace || '未知' }}</div>
                            </div>
                          </div>
                          <div class="item">
                            <i class="layer group icon" style="font-size: 0.9em;"></i>
                            <div class="content">
                              <div class="header">位深度</div>
                              <div class="description">{{ state.analyzeImageInfo.depth || '未知' }}</div>
                            </div>
                          </div>
                          <div class="item" v-if="state.analyzeFilename">
                            <i class="file outline icon" style="font-size: 0.9em;"></i>
                            <div class="content">
                              <div class="header">文件名</div>
                              <div class="description" style="word-break: break-all; font-size: 0.75em;">{{ state.analyzeFilename }}</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 详细信息 JSON -->
              <div v-if="state.analyzeImageInfo" style="margin-top: 0.75rem;">
                <div class="collapsible-section">
                  <div class="collapsible-header" :class="{ collapsed: state.analyzeJsonCollapsed }" @click="state.analyzeJsonCollapsed = !state.analyzeJsonCollapsed">
                    <span style="font-size: 0.9em; font-weight: 500;">详细信息 (JSON)</span>
                    <div>
                      <button class="ui mini button" @click.stop="copyAnalyzeInfo" style="margin-right: 0.5rem; padding: 0.3em 0.5em;">
                        <i class="copy icon"></i> 复制
                      </button>
                      <i class="chevron down icon"></i>
                    </div>
                  </div>
                  <div class="collapsible-content" :class="{ collapsed: state.analyzeJsonCollapsed }">
                    <pre class="code-output" style="max-height: 200px; overflow-y: auto; margin: 0;">{{ JSON.stringify(state.analyzeImageInfo, null, 2) }}</pre>
                  </div>
                </div>
              </div>

              <!-- 操作按钮 -->
              <div v-if="state.analyzeImage" style="margin-top: 0.75rem; display: flex; gap: 0.5rem;">
                <button class="ui small primary button" @click="useAnalyzeImageForProcess" style="flex: 1;">
                  <i class="arrow right icon"></i> 用于处理
                </button>
                <button class="ui small button" @click="clearAnalyzeImage" style="flex: 1;">
                  <i class="trash icon"></i> 清除
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- 图像处理 -->
        <div class="view-container" :class="{ active: state.currentView === 'process' }">
          <div class="section">
            <h1 class="ui header">
              <i class="wrench icon"></i>
              <div class="content">
                图像处理
                <div class="sub header">上传图片并进行各种处理操作</div>
              </div>
            </h1>

            <!-- 上传区域 -->
            <div class="ui segment compact-segment">
              <h3 class="ui dividing header" style="font-size: 0.95em; margin-bottom: 0.75rem;">上传图片</h3>
              
              <!-- 统一输入框 -->
              <div class="ui form">
                <div class="field" style="margin-bottom: 0.75rem;">
                  <label style="font-size: 0.85em; margin-bottom: 0.25rem;">图片地址（网络 URL 或选择本地文件）</label>
                  <div class="ui action input" style="font-size: 0.9em;">
                    <input type="text" v-model="state.imageUrl" placeholder="输入网络图片 URL" @keyup.enter="handleUrlUpload" style="font-size: 0.9em;">
                    <button class="ui primary button" :class="{ loading: state.loading.urlUpload }" @click="handleUrlUpload" :disabled="!state.imageUrl || state.loading.urlUpload" style="font-size: 0.85em; padding: 0.5em 0.75em;">
                      <i class="download icon"></i> 加载
                    </button>
                  </div>
                  <p style="color: #999; font-size: 0.8em; margin-top: 0.5rem;">支持 JPG, PNG, GIF, BMP, WEBP, SVG, TIFF</p>
                </div>
              </div>
              <div v-if="state.currentImage" style="margin-top: 0.75rem;">
                <img :src="state.currentImage" class="image-preview" alt="当前图片">
                <div class="ui small message" style="padding: 0.5rem; margin-top: 0.5rem;">
                  <p style="margin: 0.25rem 0; font-size: 0.85em;"><strong>文件名:</strong> {{ state.currentFilename }}</p>
                  <p v-if="state.imageInfo" style="margin: 0.25rem 0; font-size: 0.85em;"><strong>尺寸:</strong> {{ state.imageInfo.width }} × {{ state.imageInfo.height }} px</p>
                </div>
              </div>
            </div>

            <!-- 操作面板 -->
            <div class="ui segment compact-segment">
              <h3 class="ui dividing header" style="font-size: 0.95em; margin-bottom: 0.75rem;">基本操作</h3>
              
              <!-- 调整大小 -->
              <div class="collapsible-section">
                <div class="collapsible-header" :class="{ collapsed: state.resizeCollapsed }" @click="state.resizeCollapsed = !state.resizeCollapsed">
                  <span style="font-size: 0.9em; font-weight: 500;">调整大小</span>
                  <i class="chevron down icon"></i>
                </div>
                <div class="collapsible-content" :class="{ collapsed: state.resizeCollapsed }">
                  <div class="ui form compact-form">
                <div class="two fields">
                  <div class="field form-field">
                    <label style="font-size: 0.85em;">宽度 (px)</label>
                    <input type="number" v-model.number="state.operations.resize.width" placeholder="宽度" style="font-size: 0.9em;">
                  </div>
                  <div class="field form-field">
                    <label style="font-size: 0.85em;">高度 (px)</label>
                    <input type="number" v-model.number="state.operations.resize.height" placeholder="高度" style="font-size: 0.9em;">
                  </div>
                </div>
                <div class="field" style="margin-bottom: 0.5rem;">
                  <div class="ui checkbox" style="font-size: 0.85em;">
                    <input type="checkbox" v-model="state.operations.resize.maintainAspectRatio" checked>
                    <label>保持宽高比</label>
                  </div>
                </div>
                <div class="field form-field">
                  <label>质量 (1-100)</label>
                  <input type="range" v-model.number="state.operations.resize.quality" min="1" max="100">
                  <span>{{ state.operations.resize.quality }}</span>
                </div>
                <button class="ui small primary button" :class="{ loading: state.loading.resize }" @click="handleResize" :disabled="!state.currentFilename || state.loading.resize">
                  应用调整大小
                </button>
              </div>

              <!-- 裁剪 -->
              <div class="ui form" style="margin-top: 2rem;">
                <h4 class="ui dividing header">裁剪</h4>
                <div class="two fields">
                  <div class="field form-field">
                    <label style="font-size: 0.85em;">X 坐标</label>
                    <input type="number" v-model.number="state.operations.crop.x" placeholder="0" style="font-size: 0.9em;">
                  </div>
                  <div class="field form-field">
                    <label style="font-size: 0.85em;">Y 坐标</label>
                    <input type="number" v-model.number="state.operations.crop.y" placeholder="0" style="font-size: 0.9em;">
                  </div>
                </div>
                <div class="two fields">
                  <div class="field form-field">
                    <label style="font-size: 0.85em;">宽度 (px)</label>
                    <input type="number" v-model.number="state.operations.crop.width" placeholder="宽度" style="font-size: 0.9em;">
                  </div>
                  <div class="field form-field">
                    <label style="font-size: 0.85em;">高度 (px)</label>
                    <input type="number" v-model.number="state.operations.crop.height" placeholder="高度" style="font-size: 0.9em;">
                  </div>
                </div>
                <button class="ui small primary button" :class="{ loading: state.loading.crop }" @click="handleCrop" :disabled="!state.currentFilename || state.loading.crop" style="font-size: 0.85em; padding: 0.5em 0.75em;">
                  应用裁剪
                </button>
                  </div>
                </div>
              </div>

              <!-- 旋转 -->
              <div class="collapsible-section">
                <div class="collapsible-header" :class="{ collapsed: state.rotateCollapsed }" @click="state.rotateCollapsed = !state.rotateCollapsed">
                  <span style="font-size: 0.9em; font-weight: 500;">旋转</span>
                  <i class="chevron down icon"></i>
                </div>
                <div class="collapsible-content" :class="{ collapsed: state.rotateCollapsed }">
                  <div class="ui form compact-form">
                <div class="field form-field">
                  <label style="font-size: 0.85em;">角度 (度)</label>
                  <input type="number" v-model.number="state.operations.rotate.degrees" placeholder="0" min="-360" max="360" style="font-size: 0.9em;">
                  <div style="margin-top: 0.5rem; display: flex; gap: 0.25rem;">
                    <button class="ui mini button" @click="state.operations.rotate.degrees = 90" style="font-size: 0.75em; padding: 0.3em 0.5em;">90°</button>
                    <button class="ui mini button" @click="state.operations.rotate.degrees = 180" style="font-size: 0.75em; padding: 0.3em 0.5em;">180°</button>
                    <button class="ui mini button" @click="state.operations.rotate.degrees = 270" style="font-size: 0.75em; padding: 0.3em 0.5em;">270°</button>
                    <button class="ui mini button" @click="state.operations.rotate.degrees = -90" style="font-size: 0.75em; padding: 0.3em 0.5em;">-90°</button>
                  </div>
                </div>
                <div class="field form-field">
                  <label style="font-size: 0.85em;">背景颜色</label>
                  <input type="color" v-model="state.operations.rotate.backgroundColor" style="font-size: 0.9em; height: 2.5em;">
                </div>
                <button class="ui small primary button" :class="{ loading: state.loading.rotate }" @click="handleRotate" :disabled="!state.currentFilename || state.loading.rotate" style="font-size: 0.85em; padding: 0.5em 0.75em;">
                  应用旋转
                </button>
                  </div>
                </div>
              </div>

              <!-- 格式转换 -->
              <div class="collapsible-section">
                <div class="collapsible-header" :class="{ collapsed: state.convertCollapsed }" @click="state.convertCollapsed = !state.convertCollapsed">
                  <span style="font-size: 0.9em; font-weight: 500;">格式转换</span>
                  <i class="chevron down icon"></i>
                </div>
                <div class="collapsible-content" :class="{ collapsed: state.convertCollapsed }">
                  <div class="ui form compact-form">
                <div class="field form-field">
                  <label style="font-size: 0.85em;">目标格式</label>
                  <select class="ui dropdown" v-model="state.operations.convert.format" style="font-size: 0.9em;">
                    <option value="jpg">JPG</option>
                    <option value="png">PNG</option>
                    <option value="gif">GIF</option>
                    <option value="webp">WEBP</option>
                    <option value="bmp">BMP</option>
                    <option value="tiff">TIFF</option>
                  </select>
                </div>
                <div class="field form-field">
                  <label style="font-size: 0.85em;">质量 (1-100)</label>
                  <input type="range" v-model.number="state.operations.convert.quality" min="1" max="100" style="font-size: 0.9em;">
                  <span style="font-size: 0.85em;">{{ state.operations.convert.quality }}</span>
                </div>
                <button class="ui small primary button" :class="{ loading: state.loading.convert }" @click="handleConvert" :disabled="!state.currentFilename || state.loading.convert" style="font-size: 0.85em; padding: 0.5em 0.75em;">
                  转换格式
                </button>
                  </div>
                </div>
              </div>

            </div>

            <!-- 结果区域 -->
            <div v-if="state.resultImage" class="ui segment" style="margin-top: 1.5rem;">
              <h3 class="ui dividing header">对比预览</h3>
              <div class="ui two column grid" style="margin: 0;">
                <div class="column" style="padding: 0.5rem;">
                  <div style="text-align: center; margin-bottom: 0.5rem;">
                    <strong style="font-size: 0.9em; color: #666;">原始图片</strong>
                  </div>
                  <img v-if="state.currentImage" :src="state.currentImage" class="image-preview" alt="原始图片" style="max-height: 400px;">
                </div>
                <div class="column" style="padding: 0.5rem;">
                  <div style="text-align: center; margin-bottom: 0.5rem;">
                    <strong style="font-size: 0.9em; color: #666;">处理结果</strong>
                  </div>
                  <img :src="state.resultImage" class="image-preview" alt="处理结果" style="max-height: 400px;">
                  <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                    <a :href="state.resultImage" :download="state.resultFilename" class="ui small primary button" style="flex: 1;">
                      <i class="download icon"></i> 下载图片
                    </a>
                    <button class="ui small button" @click="useAsSource" style="flex: 1;">
                      作为新源图片
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 水印 -->
        <div class="view-container" :class="{ active: state.currentView === 'watermark' }">
          <div class="section">
            <h1 class="ui header">
              <i class="tint icon"></i>
              <div class="content">
                水印
                <div class="sub header">为图片添加文字或图片水印</div>
              </div>
            </h1>

            <!-- 上传区域 -->
            <div class="ui segment compact-segment">
              <h3 class="ui dividing header" style="font-size: 0.95em; margin-bottom: 0.75rem;">上传图片</h3>
              
              <!-- 统一输入框 -->
              <div class="ui form">
                <div class="field" style="margin-bottom: 0.75rem;">
                  <label style="font-size: 0.85em; margin-bottom: 0.25rem;">图片地址（网络 URL 或选择本地文件）</label>
                  <div class="ui action input" style="font-size: 0.9em;">
                    <input type="text" v-model="state.watermarkImageUrl" placeholder="输入网络图片 URL" @keyup.enter="handleWatermarkUrlUpload" style="font-size: 0.9em;">
                    <button class="ui primary button" :class="{ loading: state.loading.watermarkUrlUpload }" @click="handleWatermarkUrlUpload" :disabled="!state.watermarkImageUrl || state.loading.watermarkUrlUpload" style="font-size: 0.85em; padding: 0.5em 0.75em;">
                      <i class="download icon"></i> 加载
                    </button>
                  </div>
                  <p style="color: #999; font-size: 0.8em; margin-top: 0.5rem;">支持 JPG, PNG, GIF, BMP, WEBP, SVG, TIFF</p>
                </div>
              </div>
              <div v-if="state.watermarkCurrentImage" style="margin-top: 0.75rem;">
                <img :src="state.watermarkCurrentImage" class="image-preview" alt="当前图片">
                <div class="ui small message" style="padding: 0.5rem; margin-top: 0.5rem;">
                  <p style="margin: 0.25rem 0; font-size: 0.85em;"><strong>文件名:</strong> {{ state.watermarkCurrentFilename }}</p>
                  <p v-if="state.watermarkImageInfo" style="margin: 0.25rem 0; font-size: 0.85em;"><strong>尺寸:</strong> {{ state.watermarkImageInfo.width }} × {{ state.watermarkImageInfo.height }} px</p>
                </div>
              </div>
            </div>

            <!-- 水印操作面板 -->
            <div class="ui segment compact-segment">
              <h3 class="ui dividing header" style="font-size: 0.95em; margin-bottom: 0.75rem;">水印设置</h3>
              
              <div class="ui form compact-form">
                <!-- 水印类型 -->
                <div class="field form-field">
                  <label style="font-size: 0.85em;">水印类型</label>
                  <select class="ui dropdown" v-model="state.operations.watermark.type" style="font-size: 0.9em;">
                    <option value="text">文字水印</option>
                    <option value="image">图片水印</option>
                  </select>
                </div>

                <!-- 文字水印选项 -->
                <template v-if="state.operations.watermark.type === 'text'">
                  <div class="field form-field">
                    <label style="font-size: 0.85em;">水印文字</label>
                    <input type="text" v-model="state.operations.watermark.text" placeholder="输入水印文字" style="font-size: 0.9em;">
                  </div>
                  <div class="two fields">
                    <div class="field form-field">
                      <label style="font-size: 0.85em;">字体大小</label>
                      <input type="number" v-model.number="state.operations.watermark.fontSize" min="8" max="200" style="font-size: 0.9em;">
                    </div>
                    <div class="field form-field">
                      <label style="font-size: 0.85em;">字体</label>
                      <select class="ui dropdown" v-model="state.operations.watermark.fontFamily" style="font-size: 0.9em;">
                        <optgroup label="中文字体">
                          <option value="Microsoft YaHei">微软雅黑</option>
                          <option value="SimHei">黑体</option>
                          <option value="SimSun">宋体</option>
                          <option value="KaiTi">楷体</option>
                          <option value="FangSong">仿宋</option>
                        </optgroup>
                        <optgroup label="英文字体">
                          <option value="Arial">Arial</option>
                          <option value="Times-Roman">Times Roman</option>
                          <option value="Courier">Courier</option>
                          <option value="Helvetica">Helvetica</option>
                          <option value="Verdana">Verdana</option>
                        </optgroup>
                      </select>
                    </div>
                  </div>
                  <div class="two fields">
                    <div class="field form-field">
                      <label style="font-size: 0.85em;">文字颜色</label>
                      <input type="color" v-model="state.operations.watermark.color" style="font-size: 0.9em; height: 2.5em;">
                    </div>
                    <div class="field form-field">
                      <label style="font-size: 0.85em;">描边颜色</label>
                      <input type="color" v-model="state.operations.watermark.strokeColor" style="font-size: 0.9em; height: 2.5em;">
                    </div>
                  </div>
                  <div class="field form-field" v-if="state.operations.watermark.strokeColor">
                    <label style="font-size: 0.85em;">描边宽度</label>
                    <input type="number" v-model.number="state.operations.watermark.strokeWidth" min="0" max="10" style="font-size: 0.9em;">
                  </div>
                </template>

                <!-- 图片水印选项 -->
                <template v-if="state.operations.watermark.type === 'image'">
                  <div class="field form-field">
                    <label style="font-size: 0.85em;">水印图片</label>
                    <input type="file" ref="watermarkImageInput" @change="handleWatermarkImageUpload" accept="image/*" style="font-size: 0.9em;">
                    <div v-if="state.operations.watermark.watermarkImageFilename" class="ui small message" style="margin-top: 0.5rem; padding: 0.5rem;">
                      <p style="margin: 0; font-size: 0.85em;">已选择: {{ state.operations.watermark.watermarkImageFilename }}</p>
                    </div>
                  </div>
                  <div class="field form-field">
                    <label style="font-size: 0.85em;">缩放比例 (0.1 - 2.0)</label>
                    <input type="range" v-model.number="state.operations.watermark.watermarkScale" min="0.1" max="2.0" step="0.1" style="font-size: 0.9em;">
                    <span style="font-size: 0.85em;">{{ state.operations.watermark.watermarkScale.toFixed(1) }}</span>
                  </div>
                </template>

                <!-- 位置设置 -->
                <div class="field form-field">
                  <label style="font-size: 0.85em;">位置</label>
                  <select class="ui dropdown" v-model="state.operations.watermark.position" style="font-size: 0.9em;">
                    <option value="top-left">左上</option>
                    <option value="top-center">上中</option>
                    <option value="top-right">右上</option>
                    <option value="center-left">左中</option>
                    <option value="center">居中</option>
                    <option value="center-right">右中</option>
                    <option value="bottom-left">左下</option>
                    <option value="bottom-center">下中</option>
                    <option value="bottom-right">右下</option>
                    <option value="custom">自定义坐标</option>
                  </select>
                </div>

                <!-- 自定义坐标 -->
                <template v-if="state.operations.watermark.position === 'custom'">
                  <div class="two fields">
                    <div class="field form-field">
                      <label style="font-size: 0.85em;">X 坐标 (px)</label>
                      <input type="number" v-model.number="state.operations.watermark.x" placeholder="0" style="font-size: 0.9em;">
                    </div>
                    <div class="field form-field">
                      <label style="font-size: 0.85em;">Y 坐标 (px)</label>
                      <input type="number" v-model.number="state.operations.watermark.y" placeholder="0" style="font-size: 0.9em;">
                    </div>
                  </div>
                </template>

                <!-- 边距设置 -->
                <template v-if="state.operations.watermark.position !== 'custom'">
                  <div class="two fields">
                    <div class="field form-field">
                      <label style="font-size: 0.85em;">X 边距 (px)</label>
                      <input type="number" v-model.number="state.operations.watermark.marginX" min="0" style="font-size: 0.9em;">
                    </div>
                    <div class="field form-field">
                      <label style="font-size: 0.85em;">Y 边距 (px)</label>
                      <input type="number" v-model.number="state.operations.watermark.marginY" min="0" style="font-size: 0.9em;">
                    </div>
                  </div>
                </template>

                <!-- 其他选项 -->
                <div class="two fields">
                  <div class="field form-field">
                    <label style="font-size: 0.85em;">透明度 (0-1)</label>
                    <input type="range" v-model.number="state.operations.watermark.opacity" min="0" max="1" step="0.1" style="font-size: 0.9em;">
                    <span style="font-size: 0.85em;">{{ state.operations.watermark.opacity.toFixed(1) }}</span>
                  </div>
                  <div class="field form-field">
                    <label style="font-size: 0.85em;">旋转角度 (度)</label>
                    <input type="number" v-model.number="state.operations.watermark.angle" min="-360" max="360" style="font-size: 0.9em;">
                  </div>
                </div>

                <!-- 重复平铺 -->
                <div class="field" style="margin-bottom: 0.5rem;">
                  <div class="ui checkbox" style="font-size: 0.85em;">
                    <input type="checkbox" v-model="state.operations.watermark.repeat">
                    <label>重复平铺</label>
                  </div>
                </div>
                <div class="field form-field" v-if="state.operations.watermark.repeat">
                  <label style="font-size: 0.85em;">平铺间距 (px)</label>
                  <input type="number" v-model.number="state.operations.watermark.tileSize" min="50" placeholder="100" style="font-size: 0.9em;">
                </div>

                <button class="ui small primary button" :class="{ loading: state.loading.watermark }" @click="handleWatermark" :disabled="!state.watermarkCurrentFilename || state.loading.watermark" style="font-size: 0.85em; padding: 0.5em 0.75em;">
                  添加水印
                </button>
              </div>
            </div>

            <!-- 结果区域 -->
            <div v-if="state.watermarkResultImage" class="ui segment compact-segment" style="margin-top: 1rem;">
              <h3 class="ui dividing header" style="font-size: 0.95em; margin-bottom: 0.75rem;">对比预览</h3>
              <div class="ui two column grid" style="margin: 0;">
                <div class="column" style="padding: 0.5rem;">
                  <div style="text-align: center; margin-bottom: 0.5rem;">
                    <strong style="font-size: 0.9em; color: #666;">原始图片</strong>
                  </div>
                  <img v-if="state.watermarkCurrentImage" :src="state.watermarkCurrentImage" class="image-preview" alt="原始图片" style="max-height: 400px;">
                </div>
                <div class="column" style="padding: 0.5rem;">
                  <div style="text-align: center; margin-bottom: 0.5rem;">
                    <strong style="font-size: 0.9em; color: #666;">处理结果</strong>
                  </div>
                  <img :src="state.watermarkResultImage" class="image-preview" alt="处理结果" style="max-height: 400px;">
                  <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem;">
                    <a :href="state.watermarkResultImage" :download="state.watermarkResultFilename" class="ui small primary button" style="flex: 1;">
                      <i class="download icon"></i> 下载图片
                    </a>
                    <button class="ui small button" @click="useWatermarkAsSource" style="flex: 1;">
                      作为新源图片
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 图片裂变 -->
        <div class="view-container" :class="{ active: state.currentView === 'effects' }">
          <div class="section">
            <h1 class="ui header">
              <i class="magic icon"></i>
              <div class="content">
                图片裂变
                <div class="sub header">应用各种图片效果，支持多种效果组合</div>
              </div>
            </h1>

            <!-- 上传区域 -->
            <div class="ui segment compact-segment">
              <h3 class="ui dividing header" style="font-size: 0.95em; margin-bottom: 0.75rem;">上传图片</h3>
              
              <!-- 统一输入框 -->
              <div class="ui form">
                <div class="field" style="margin-bottom: 0.75rem;">
                  <label style="font-size: 0.85em; margin-bottom: 0.25rem;">图片地址（网络 URL 或选择本地文件）</label>
                  <div class="ui action input" style="font-size: 0.9em;">
                    <input type="text" v-model="state.effectsImageUrl" placeholder="输入网络图片 URL" @keyup.enter="handleEffectsUrlUpload" style="font-size: 0.9em;">
                    <button class="ui primary button" :class="{ loading: state.loading.effectsUrlUpload }" @click="handleEffectsUrlUpload" :disabled="!state.effectsImageUrl || state.loading.effectsUrlUpload" style="font-size: 0.85em; padding: 0.5em 0.75em;">
                      <i class="download icon"></i> 加载
                    </button>
                  </div>
                  <p style="color: #999; font-size: 0.8em; margin-top: 0.5rem;">支持 JPG, PNG, GIF, BMP, WEBP, SVG, TIFF</p>
                </div>
              </div>
              <div v-if="state.effectsCurrentImage" style="margin-top: 0.75rem;">
                <img :src="state.effectsCurrentImage" class="image-preview" alt="当前图片">
                <div class="ui small message" style="padding: 0.5rem; margin-top: 0.5rem;">
                  <p style="margin: 0.25rem 0; font-size: 0.85em;"><strong>文件名:</strong> {{ state.effectsCurrentFilename }}</p>
                  <p v-if="state.effectsImageInfo" style="margin: 0.25rem 0; font-size: 0.85em;"><strong>尺寸:</strong> {{ state.effectsImageInfo.width }} × {{ state.effectsImageInfo.height }} px</p>
                </div>
              </div>
            </div>

            <!-- 效果选择区域 -->
            <div class="ui segment compact-segment">
              <h3 class="ui dividing header" style="font-size: 0.95em; margin-bottom: 0.75rem;">
                效果列表
                <button class="ui tiny button" @click="addEffect" style="margin-left: 0.5rem; font-size: 0.8em;">
                  <i class="plus icon"></i> 添加效果
                </button>
              </h3>
              
              <div v-if="state.effectsList.length === 0" class="ui message" style="padding: 1rem; text-align: center; color: #999;">
                点击"添加效果"按钮开始添加图片效果
              </div>

              <div v-for="(effect, index) in state.effectsList" :key="index" class="ui segment" style="margin-bottom: 0.75rem; padding: 0.75rem;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                  <strong style="font-size: 0.9em;">效果 {{ index + 1 }}: {{ getEffectName(effect.type) }}</strong>
                  <button class="ui tiny red button" @click="removeEffect(index)" style="font-size: 0.75em; padding: 0.25em 0.5em;">
                    <i class="trash icon"></i> 删除
                  </button>
                </div>
                
                <div class="ui form compact-form">
                  <div class="field form-field">
                    <label style="font-size: 0.85em;">效果类型</label>
                    <select class="ui dropdown" v-model="effect.type" style="font-size: 0.9em;" @change="updateEffectParams(effect)">
                      <optgroup label="基础效果">
                        <option value="grayscale">黑白化</option>
                        <option value="negate">负片</option>
                        <option value="sepia">怀旧</option>
                      </optgroup>
                      <optgroup label="模糊和锐化">
                        <option value="blur">模糊</option>
                        <option value="gaussian-blur">高斯模糊</option>
                        <option value="motion-blur">运动模糊</option>
                        <option value="sharpen">锐化</option>
                        <option value="unsharp">非锐化遮罩</option>
                      </optgroup>
                      <optgroup label="艺术效果">
                        <option value="charcoal">炭笔画</option>
                        <option value="oil-painting">油画</option>
                        <option value="sketch">素描</option>
                        <option value="emboss">浮雕</option>
                        <option value="edge">边缘检测</option>
                        <option value="posterize">海报化</option>
                      </optgroup>
                      <optgroup label="像素化">
                        <option value="pixelate">像素化</option>
                        <option value="mosaic">马赛克</option>
                      </optgroup>
                      <optgroup label="颜色调整">
                        <option value="brightness">亮度</option>
                        <option value="contrast">对比度</option>
                        <option value="saturation">饱和度</option>
                        <option value="hue">色相</option>
                        <option value="colorize">着色</option>
                        <option value="tint">色调</option>
                      </optgroup>
                      <optgroup label="特殊效果">
                        <option value="noise">噪点</option>
                        <option value="despeckle">去噪点</option>
                        <option value="vignette">晕影</option>
                        <option value="solarize">曝光</option>
                        <option value="swirl">漩涡</option>
                        <option value="wave">波浪</option>
                        <option value="implode">内爆</option>
                        <option value="explode">爆炸</option>
                        <option value="spread">扩散</option>
                        <option value="normalize">标准化</option>
                        <option value="equalize">均衡化</option>
                        <option value="gamma">伽马校正</option>
                        <option value="threshold">阈值化</option>
                        <option value="quantize">量化</option>
                      </optgroup>
                    </select>
                  </div>

                  <!-- 效果说明区域 -->
                  <div class="ui info message" style="margin-top: 0.75rem; padding: 0.75rem; font-size: 0.85em;">
                    <div style="margin-bottom: 0.5rem;">
                      <strong style="color: #2185d0;">定义：</strong>
                      <span>{{ getEffectOfficialTerm(effect.type) }}</span>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                      <strong style="color: #2185d0;">描述：</strong>
                      <span>{{ getEffectDescription(effect.type) }}</span>
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                      <strong>效果说明：</strong>
                      <span>{{ getEffectExplanation(effect.type) }}</span>
                    </div>
                  </div>

                  <!-- 参数表单区域 -->
                  <div class="ui divider" style="margin: 0.75rem 0;"></div>
                  <div style="font-size: 0.85em; color: #666; margin-bottom: 0.5rem; font-weight: bold;">效果参数</div>
                  
                  <!-- 灰度转换方法参数 -->
                  <template v-if="needsMethod(effect.type)">
                    <div class="field form-field" style="margin-bottom: 0.75rem;">
                      <label style="font-size: 0.85em;">转换方法</label>
                      <select class="ui dropdown" v-model="effect.method" style="font-size: 0.9em;">
                        <option value="Rec601Luma">Rec601 亮度加权（标准）</option>
                        <option value="Rec709Luma">Rec709 亮度加权</option>
                        <option value="luminance">亮度加权法</option>
                        <option value="average">平均法</option>
                        <option value="desaturate">去饱和度法</option>
                      </select>
                      <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">选择灰度转换的算法方法</p>
                    </div>
                  </template>

                  <!-- 灰度强度参数 -->
                  <template v-if="needsGrayscaleIntensity(effect.type)">
                    <div class="field form-field" style="margin-bottom: 0.75rem;">
                      <label style="font-size: 0.85em;">灰度强度 <span style="color: #999; font-weight: normal;">(%)</span></label>
                      <input type="range" v-model.number="effect.intensity" min="0" max="100" step="1" style="width: 100%; margin-bottom: 0.25rem;">
                      <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="number" v-model.number="effect.intensity" min="0" max="100" step="1" style="flex: 1; font-size: 0.9em;">
                        <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ effect.intensity }}%</span>
                      </div>
                      <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">控制灰度化的强度，100%为完全黑白，0%为原图</p>
                    </div>
                  </template>
                  
                  <!-- 两列布局的参数表单 -->
                  <div class="two fields" style="margin-bottom: 0.5rem;">
                    <!-- 半径参数 -->
                    <template v-if="needsRadius(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">半径 <span style="color: #999; font-weight: normal;">({{ getParamUnit(effect.type, 'radius') }})</span></label>
                        <input type="range" v-model.number="effect.radius" :min="getMinValue(effect.type, 'radius')" :max="getMaxValue(effect.type, 'radius')" :step="getStepValue(effect.type, 'radius')" style="width: 100%; margin-bottom: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="number" v-model.number="effect.radius" :min="getMinValue(effect.type, 'radius')" :max="getMaxValue(effect.type, 'radius')" :step="getStepValue(effect.type, 'radius')" style="flex: 1; font-size: 0.9em;">
                          <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ formatParamValue(effect.radius, getStepValue(effect.type, 'radius')) }}</span>
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'radius') }}</p>
                      </div>
                    </template>

                    <!-- 标准差参数 -->
                    <template v-if="needsSigma(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">标准差 <span style="color: #999; font-weight: normal;">({{ getParamUnit(effect.type, 'sigma') }})</span></label>
                        <input type="range" v-model.number="effect.sigma" :min="getMinValue(effect.type, 'sigma')" :max="getMaxValue(effect.type, 'sigma')" :step="getStepValue(effect.type, 'sigma')" style="width: 100%; margin-bottom: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="number" v-model.number="effect.sigma" :min="getMinValue(effect.type, 'sigma')" :max="getMaxValue(effect.type, 'sigma')" :step="getStepValue(effect.type, 'sigma')" style="flex: 1; font-size: 0.9em;">
                          <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ formatParamValue(effect.sigma, getStepValue(effect.type, 'sigma')) }}</span>
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'sigma') }}</p>
                      </div>
                    </template>
                  </div>

                  <div class="two fields" style="margin-bottom: 0.5rem;">
                    <!-- 强度参数 -->
                    <template v-if="needsIntensity(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">强度 <span style="color: #999; font-weight: normal;">(%)</span></label>
                        <input type="range" v-model.number="effect.intensity" :min="getMinValue(effect.type, 'intensity')" :max="getMaxValue(effect.type, 'intensity')" :step="getStepValue(effect.type, 'intensity')" style="width: 100%; margin-bottom: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="number" v-model.number="effect.intensity" :min="getMinValue(effect.type, 'intensity')" :max="getMaxValue(effect.type, 'intensity')" :step="getStepValue(effect.type, 'intensity')" style="flex: 1; font-size: 0.9em;">
                          <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ effect.intensity }}%</span>
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'intensity') }}</p>
                      </div>
                    </template>

                    <!-- 数值参数 -->
                    <template v-if="needsValue(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">{{ getValueLabel(effect.type) }} <span style="color: #999; font-weight: normal;">({{ getParamUnit(effect.type, 'value') }})</span></label>
                        <input type="range" v-model.number="effect.value" :min="getMinValue(effect.type, 'value')" :max="getMaxValue(effect.type, 'value')" :step="getStepValue(effect.type, 'value')" style="width: 100%; margin-bottom: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="number" v-model.number="effect.value" :min="getMinValue(effect.type, 'value')" :max="getMaxValue(effect.type, 'value')" :step="getStepValue(effect.type, 'value')" style="flex: 1; font-size: 0.9em;">
                          <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ formatParamValue(effect.value, getStepValue(effect.type, 'value')) }}</span>
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'value') }}</p>
                      </div>
                    </template>
                  </div>

                  <div class="two fields" style="margin-bottom: 0.5rem;">
                    <!-- 颜色参数 -->
                    <template v-if="needsColor(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">颜色</label>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="color" v-model="effect.color" style="flex: 1; font-size: 0.9em; height: 2.5em; cursor: pointer;">
                          <input type="text" v-model="effect.color" style="flex: 1; font-size: 0.85em; padding: 0.4em;" placeholder="#FF0000">
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'color') }}</p>
                      </div>
                    </template>

                    <!-- 尺寸参数 -->
                    <template v-if="needsSize(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">尺寸 <span style="color: #999; font-weight: normal;">(像素)</span></label>
                        <input type="range" v-model.number="effect.size" :min="getMinValue(effect.type, 'size')" :max="getMaxValue(effect.type, 'size')" step="1" style="width: 100%; margin-bottom: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="number" v-model.number="effect.size" :min="getMinValue(effect.type, 'size')" :max="getMaxValue(effect.type, 'size')" style="flex: 1; font-size: 0.9em;">
                          <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ effect.size }}px</span>
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'size') }}</p>
                      </div>
                    </template>
                  </div>

                  <div class="two fields" style="margin-bottom: 0.5rem;">
                    <!-- 角度参数 -->
                    <template v-if="needsAngle(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">角度 <span style="color: #999; font-weight: normal;">(度)</span></label>
                        <input type="range" v-model.number="effect.angle" :min="getMinValue(effect.type, 'angle')" :max="getMaxValue(effect.type, 'angle')" step="1" style="width: 100%; margin-bottom: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="number" v-model.number="effect.angle" :min="getMinValue(effect.type, 'angle')" :max="getMaxValue(effect.type, 'angle')" style="flex: 1; font-size: 0.9em;">
                          <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ effect.angle }}°</span>
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'angle') }}</p>
                      </div>
                    </template>

                    <!-- 数量参数 -->
                    <template v-if="needsAmount(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">数量 <span style="color: #999; font-weight: normal;">({{ getParamUnit(effect.type, 'amount') }})</span></label>
                        <input type="range" v-model.number="effect.amount" :min="getMinValue(effect.type, 'amount')" :max="getMaxValue(effect.type, 'amount')" :step="getStepValue(effect.type, 'amount')" style="width: 100%; margin-bottom: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="number" v-model.number="effect.amount" :min="getMinValue(effect.type, 'amount')" :max="getMaxValue(effect.type, 'amount')" :step="getStepValue(effect.type, 'amount')" style="flex: 1; font-size: 0.9em;">
                          <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ formatParamValue(effect.amount, getStepValue(effect.type, 'amount')) }}</span>
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'amount') }}</p>
                      </div>
                    </template>
                  </div>

                  <div class="two fields" style="margin-bottom: 0.5rem;">
                    <!-- 阈值参数 -->
                    <template v-if="needsThreshold(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">阈值 <span style="color: #999; font-weight: normal;">({{ getParamUnit(effect.type, 'threshold') }})</span></label>
                        <input type="range" v-model.number="effect.threshold" :min="getMinValue(effect.type, 'threshold')" :max="getMaxValue(effect.type, 'threshold')" :step="getStepValue(effect.type, 'threshold')" style="width: 100%; margin-bottom: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="number" v-model.number="effect.threshold" :min="getMinValue(effect.type, 'threshold')" :max="getMaxValue(effect.type, 'threshold')" :step="getStepValue(effect.type, 'threshold')" style="flex: 1; font-size: 0.9em;">
                          <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ formatParamValue(effect.threshold, getStepValue(effect.type, 'threshold')) }}</span>
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'threshold') }}</p>
                      </div>
                    </template>

                    <!-- 颜色数量参数 -->
                    <template v-if="needsColors(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">颜色数量</label>
                        <input type="range" v-model.number="effect.colors" :min="getMinValue(effect.type, 'colors')" :max="getMaxValue(effect.type, 'colors')" step="1" style="width: 100%; margin-bottom: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="number" v-model.number="effect.colors" :min="getMinValue(effect.type, 'colors')" :max="getMaxValue(effect.type, 'colors')" style="flex: 1; font-size: 0.9em;">
                          <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ effect.colors }}</span>
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'colors') }}</p>
                      </div>
                    </template>
                  </div>

                  <div class="two fields" style="margin-bottom: 0.5rem;">
                    <!-- 级别数参数 -->
                    <template v-if="needsLevels(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">级别数</label>
                        <input type="range" v-model.number="effect.levels" :min="getMinValue(effect.type, 'levels')" :max="getMaxValue(effect.type, 'levels')" step="1" style="width: 100%; margin-bottom: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="number" v-model.number="effect.levels" :min="getMinValue(effect.type, 'levels')" :max="getMaxValue(effect.type, 'levels')" style="flex: 1; font-size: 0.9em;">
                          <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ effect.levels }}</span>
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'levels') }}</p>
                      </div>
                    </template>

                    <!-- 噪点类型参数 -->
                    <template v-if="needsNoiseType(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">噪点类型</label>
                        <select class="ui dropdown" v-model="effect.noiseType" style="font-size: 0.9em;">
                          <option value="Uniform">均匀 (Uniform)</option>
                          <option value="Gaussian">高斯 (Gaussian)</option>
                          <option value="Impulse">脉冲 (Impulse)</option>
                          <option value="Laplacian">拉普拉斯 (Laplacian)</option>
                          <option value="Poisson">泊松 (Poisson)</option>
                          <option value="Random">随机 (Random)</option>
                        </select>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'noiseType') }}</p>
                      </div>
                    </template>
                  </div>

                  <div class="two fields" style="margin-bottom: 0.5rem;">
                    <!-- 振幅参数 -->
                    <template v-if="needsAmplitude(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">振幅 <span style="color: #999; font-weight: normal;">(像素)</span></label>
                        <input type="range" v-model.number="effect.amplitude" :min="getMinValue(effect.type, 'amplitude')" :max="getMaxValue(effect.type, 'amplitude')" step="1" style="width: 100%; margin-bottom: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="number" v-model.number="effect.amplitude" :min="getMinValue(effect.type, 'amplitude')" :max="getMaxValue(effect.type, 'amplitude')" style="flex: 1; font-size: 0.9em;">
                          <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ effect.amplitude }}px</span>
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'amplitude') }}</p>
                      </div>
                    </template>

                    <!-- 波长参数 -->
                    <template v-if="needsWavelength(effect.type)">
                      <div class="field form-field">
                        <label style="font-size: 0.85em;">波长 <span style="color: #999; font-weight: normal;">(像素)</span></label>
                        <input type="range" v-model.number="effect.wavelength" :min="getMinValue(effect.type, 'wavelength')" :max="getMaxValue(effect.type, 'wavelength')" step="1" style="width: 100%; margin-bottom: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <input type="number" v-model.number="effect.wavelength" :min="getMinValue(effect.type, 'wavelength')" :max="getMaxValue(effect.type, 'wavelength')" style="flex: 1; font-size: 0.9em;">
                          <span style="font-size: 0.8em; color: #999; min-width: 3em; text-align: right;">{{ effect.wavelength }}px</span>
                        </div>
                        <p style="font-size: 0.75em; color: #999; margin-top: 0.25rem; margin-bottom: 0;">{{ getParamDescription(effect.type, 'wavelength') }}</p>
                      </div>
                    </template>
                  </div>
                </div>
              </div>

              <div v-if="state.effectsList.length > 0" style="margin-top: 1rem;">
                <button class="ui small primary button" :class="{ loading: state.loading.effects }" @click="handleEffects" :disabled="!state.effectsCurrentFilename || state.loading.effects" style="font-size: 0.85em; padding: 0.5em 0.75em;">
                  <i class="magic icon"></i> 应用效果
                </button>
                <button class="ui small button" @click="clearEffects" style="font-size: 0.85em; padding: 0.5em 0.75em; margin-left: 0.5rem;">
                  清空效果列表
                </button>
              </div>
            </div>

            <!-- 结果区域 -->
            <div v-if="state.effectsResultImage" class="ui segment compact-segment" style="margin-top: 1rem;">
              <h3 class="ui dividing header" style="font-size: 0.95em; margin-bottom: 0.75rem;">对比预览</h3>
              <div class="ui two column grid" style="margin: 0;">
                <div class="column" style="padding: 0.5rem;">
                  <div style="text-align: center; margin-bottom: 0.5rem;">
                    <strong style="font-size: 0.9em; color: #666;">原始图片</strong>
                  </div>
                  <img v-if="state.effectsCurrentImage" :src="state.effectsCurrentImage" class="image-preview" alt="原始图片" style="max-height: 400px;">
                </div>
                <div class="column" style="padding: 0.5rem;">
                  <div style="text-align: center; margin-bottom: 0.5rem;">
                    <strong style="font-size: 0.9em; color: #666;">处理结果</strong>
                  </div>
                  <img :src="state.effectsResultImage" class="image-preview" alt="处理结果" style="max-height: 400px;">
                  <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem;">
                    <a :href="state.effectsResultImage" :download="state.effectsResultFilename" class="ui small primary button" style="flex: 1;">
                      <i class="download icon"></i> 下载图片
                    </a>
                    <button class="ui small button" @click="useEffectsAsSource" style="flex: 1;">
                      作为新源图片
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </main>

      <!-- 右侧调试输出面板 -->
      <aside class="debug-panel">
        <div class="debug-panel-header">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem;">
            <h3 class="ui header" style="margin: 0; font-size: 1em;">
              <i class="bug icon"></i>
              <div class="content">
                调试输出
                <div class="sub header" style="font-size: 0.75em;">实时调试信息和日志</div>
              </div>
            </h3>
            <button class="ui tiny button" @click="clearDebugLog">清空</button>
          </div>
          <div class="debug-tabs">
            <div 
              v-for="tab in debugTabs" 
              :key="tab.id"
              class="debug-tab"
              :class="{ active: state.currentDebugTab === tab.id }"
              @click="state.currentDebugTab = tab.id"
            >
              {{ tab.name }}
              <span v-if="tab.count > 0" style="margin-left: 0.25rem;">({{ tab.count }})</span>
            </div>
          </div>
        </div>
        <div class="debug-panel-content">
          <div class="debug-log">
            <div v-if="filteredDebugLogs.length === 0" style="color: #888; text-align: center; padding: 2rem;">
              暂无调试信息
            </div>
            <div 
              v-for="(log, index) in filteredDebugLogs" 
              :key="index"
              class="debug-log-item"
            >
              <div class="debug-log-time">{{ log.time }}</div>
              <div class="debug-log-content" :class="log.type">{{ log.content }}</div>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Semantic UI JS -->
  <script src="https://cdn.bootcdn.net/ajax/libs/semantic-ui/2.5.0/semantic.min.js"></script>
  <script src="app.js"></script>
</body>
</html>

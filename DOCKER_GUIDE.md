# ğŸ³ Docker å®Œå…¨æŒ‡å—

## ğŸ“š Docker åŸºç¡€æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ Dockerï¼Ÿ

Docker æ˜¯ä¸€ä¸ª**å®¹å™¨åŒ–å¹³å°**ï¼Œå¯ä»¥æŠŠä½ åº”ç”¨ç¨‹åºå’Œæ‰€æœ‰ä¾èµ–æ‰“åŒ…æˆä¸€ä¸ªç‹¬ç«‹çš„"å®¹å™¨"ã€‚

**ç±»æ¯”ç†è§£ï¼š**
- **è™šæ‹Ÿæœº**ï¼šåƒæ˜¯ä¸€æ•´å°ç”µè„‘ï¼ˆåŒ…å«æ“ä½œç³»ç»Ÿï¼‰
- **Docker å®¹å™¨**ï¼šåƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„"åº”ç”¨ç›’å­"ï¼ˆåªåŒ…å«åº”ç”¨å’Œå¿…è¦ä¾èµ–ï¼‰

### Docker çš„æ ¸å¿ƒæ¦‚å¿µ

1. **é•œåƒï¼ˆImageï¼‰**
   - å°±åƒ"æ¨¡æ¿"æˆ–"è“å›¾"
   - åŒ…å«äº†è¿è¡Œåº”ç”¨æ‰€éœ€çš„ä¸€åˆ‡ï¼ˆä»£ç ã€ä¾èµ–ã€é…ç½®ï¼‰
   - ä¾‹å¦‚ï¼š`yishe-images:latest`

2. **å®¹å™¨ï¼ˆContainerï¼‰**
   - é•œåƒçš„"è¿è¡Œå®ä¾‹"
   - å°±åƒä»æ¨¡æ¿åˆ›å»ºçš„ä¸€ä¸ªå®é™…è¿è¡Œçš„"ç›’å­"
   - å¯ä»¥å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤

3. **Dockerfile**
   - æ„å»ºé•œåƒçš„"è¯´æ˜ä¹¦"
   - å‘Šè¯‰ Docker å¦‚ä½•ä¸€æ­¥æ­¥æ„å»ºé•œåƒ

4. **Docker Compose**
   - ç®¡ç†å¤šä¸ªå®¹å™¨çš„å·¥å…·
   - ç”¨ YAML æ–‡ä»¶å®šä¹‰æœåŠ¡é…ç½®

---

## ğŸ”¨ Dockerfile è¯¦è§£

è®©æˆ‘ä»¬çœ‹çœ‹ `Dockerfile` çš„æ¯ä¸€è¡Œï¼š

```dockerfile
FROM node:18-slim
```
**ä½œç”¨**ï¼šé€‰æ‹©åŸºç¡€é•œåƒ
- `node:18`ï¼šNode.js 18 ç‰ˆæœ¬
- `slim`ï¼šç²¾ç®€ç‰ˆï¼ˆæ›´å°ï¼ŒåªåŒ…å«å¿…è¦ç»„ä»¶ï¼‰

```dockerfile
WORKDIR /app
```
**ä½œç”¨**ï¼šè®¾ç½®å·¥ä½œç›®å½•ï¼ˆç›¸å½“äº `cd /app`ï¼‰

```dockerfile
RUN apt-get update && apt-get install -y imagemagick
```
**ä½œç”¨**ï¼šå®‰è£… ImageMagick
- `apt-get update`ï¼šæ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
- `apt-get install -y imagemagick`ï¼šå®‰è£… ImageMagick
- `&&`ï¼šå¦‚æœå‰ä¸€ä¸ªå‘½ä»¤æˆåŠŸï¼Œæ‰æ‰§è¡Œä¸‹ä¸€ä¸ª

```dockerfile
COPY package*.json ./
```
**ä½œç”¨**ï¼šå¤åˆ¶ä¾èµ–æ–‡ä»¶
- å…ˆå¤åˆ¶ `package.json`ï¼Œåˆ©ç”¨ Docker ç¼“å­˜ä¼˜åŒ–æ„å»ºé€Ÿåº¦

```dockerfile
RUN npm ci --only=production
```
**ä½œç”¨**ï¼šå®‰è£… Node.js ä¾èµ–
- `npm ci`ï¼šå¿«é€Ÿã€å¯é çš„å®‰è£…ï¼ˆé€‚åˆç”Ÿäº§ç¯å¢ƒï¼‰
- `--only=production`ï¼šåªå®‰è£…ç”Ÿäº§ä¾èµ–

```dockerfile
COPY . .
```
**ä½œç”¨**ï¼šå¤åˆ¶æ‰€æœ‰é¡¹ç›®æ–‡ä»¶

```dockerfile
EXPOSE 1513
```
**ä½œç”¨**ï¼šå£°æ˜å®¹å™¨ç›‘å¬çš„ç«¯å£

```dockerfile
CMD ["node", "server.js"]
```
**ä½œç”¨**ï¼šå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼ˆæ„å»ºé•œåƒï¼‰

```bash
# 1. æ„å»ºé•œåƒ
docker build -t yishe-images:latest .

# è¿™ä¸ªè¿‡ç¨‹ä¼šï¼š
# - ä¸‹è½½ Node.js åŸºç¡€é•œåƒ
# - å®‰è£… ImageMagick
# - å®‰è£… Node.js ä¾èµ–
# - å¤åˆ¶é¡¹ç›®æ–‡ä»¶
# - åˆ›å»ºé•œåƒ

# 2. è¿è¡Œå®¹å™¨
docker run -d -p 1513:1513 --name yishe-images yishe-images:latest
```

### ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

```bash
# ä¸€é”®æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# è¿™ä¸ªå‘½ä»¤ä¼šï¼š
# 1. è¯»å– docker-compose.yml
# 2. æ„å»ºé•œåƒï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
# 3. å¯åŠ¨å®¹å™¨
# 4. é…ç½®ç«¯å£æ˜ å°„
# 5. æŒ‚è½½æ•°æ®å·
```

---

## ğŸ“¦ é•œåƒæ„å»ºè¿‡ç¨‹

å½“ä½ è¿è¡Œ `docker build` æ—¶ï¼ŒDocker ä¼šï¼š

1. **è¯»å– Dockerfile**
   ```
   ä»ç¬¬ä¸€è¡Œå¼€å§‹ï¼Œé€æ­¥æ‰§è¡ŒæŒ‡ä»¤
   ```

2. **åˆ›å»ºå±‚ï¼ˆLayerï¼‰**
   ```
   æ¯ä¸€è¡ŒæŒ‡ä»¤åˆ›å»ºä¸€ä¸ªå±‚
   å±‚å¯ä»¥ç¼“å­˜ï¼Œæé«˜æ„å»ºé€Ÿåº¦
   ```

3. **æœ€ç»ˆç”Ÿæˆé•œåƒ**
   ```
   æ‰€æœ‰å±‚å åŠ åœ¨ä¸€èµ· = æœ€ç»ˆé•œåƒ
   ```

**ä¼˜åŒ–æŠ€å·§ï¼š**
- å…ˆå¤åˆ¶ `package.json`ï¼Œå†å®‰è£…ä¾èµ–
- å¦‚æœä¾èµ–æ²¡å˜ï¼ŒDocker ä¼šä½¿ç”¨ç¼“å­˜ï¼Œè·³è¿‡å®‰è£…æ­¥éª¤
- æœ€åå¤åˆ¶ä»£ç ï¼Œä»£ç æ”¹åŠ¨ä¸å½±å“ä¾èµ–å±‚

---

## ğŸ”„ å®¹å™¨ç”Ÿå‘½å‘¨æœŸ

```
æ„å»ºé•œåƒ â†’ åˆ›å»ºå®¹å™¨ â†’ å¯åŠ¨å®¹å™¨ â†’ è¿è¡Œ â†’ åœæ­¢ â†’ åˆ é™¤
   â†“          â†“          â†“        â†“      â†“      â†“
docker build docker run docker start è¿è¡Œä¸­ docker stop docker rm
```

### å¸¸ç”¨æ“ä½œ

```bash
# åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨
docker run -d -p 1513:1513 yishe-images:latest

# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs yishe-images

# åœæ­¢å®¹å™¨
docker stop yishe-images

# å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨
docker start yishe-images

# é‡å¯å®¹å™¨
docker restart yishe-images

# åˆ é™¤å®¹å™¨
docker rm yishe-images

# åˆ é™¤é•œåƒ
docker rmi yishe-images:latest
```

---

## ğŸ’¾ æ•°æ®æŒä¹…åŒ–

### é—®é¢˜ï¼šå®¹å™¨åˆ é™¤åæ•°æ®ä¼šä¸¢å¤±

**è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨æ•°æ®å·ï¼ˆVolumeï¼‰**

```yaml
volumes:
  - ./uploads:/app/uploads
  - ./output:/app/output
```

**å«ä¹‰ï¼š**
- `./uploads`ï¼šå®¿ä¸»æœºçš„ç›®å½•
- `/app/uploads`ï¼šå®¹å™¨å†…çš„ç›®å½•
- `:`ï¼šæ˜ å°„å…³ç³»

**æ•ˆæœï¼š**
- å®¹å™¨å†…çš„æ–‡ä»¶ä¼šä¿å­˜åˆ°å®¿ä¸»æœº
- å³ä½¿åˆ é™¤å®¹å™¨ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±

---

## ğŸŒ ç«¯å£æ˜ å°„

```yaml
ports:
  - "1513:1513"
```

**å«ä¹‰ï¼š**
- å·¦è¾¹ `1513`ï¼šå®¿ä¸»æœºç«¯å£
- å³è¾¹ `1513`ï¼šå®¹å™¨ç«¯å£
- `:`ï¼šæ˜ å°„å…³ç³»

**æ•ˆæœï¼š**
- è®¿é—® `localhost:1513` â†’ è½¬å‘åˆ°å®¹å™¨çš„ `1513` ç«¯å£
- å¯ä»¥ä¿®æ”¹å·¦è¾¹ç«¯å£ï¼š`"8080:1513"`ï¼ˆè®¿é—® `localhost:8080`ï¼‰

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. è¿›å…¥å®¹å™¨å†…éƒ¨

```bash
docker exec -it yishe-images bash

# ç°åœ¨ä½ å¯ä»¥åœ¨å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤ï¼š
ls -la
magick --version
node --version
```

### 2. æŸ¥çœ‹å®¹å™¨æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f yishe-images

# æŸ¥çœ‹æœ€å 100 è¡Œ
docker logs --tail 100 yishe-images
```

### 3. æ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect yishe-images

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats yishe-images
```

### 4. æµ‹è¯• ImageMagick

```bash
# è¿›å…¥å®¹å™¨
docker exec -it yishe-images bash

# æµ‹è¯• ImageMagick
magick --version
convert --version

# æµ‹è¯•å›¾ç‰‡å¤„ç†
magick -size 100x100 xc:red test.png
```

---

## ğŸ“‹ å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

### åœºæ™¯ï¼šåœ¨æ–°è®¾å¤‡ä¸Šéƒ¨ç½²

```bash
# 1. å®‰è£… Dockerï¼ˆåªéœ€ä¸€æ¬¡ï¼‰
# Windows/Mac: ä¸‹è½½ Docker Desktop
# Linux: sudo apt-get install docker.io

# 2. å…‹éš†æˆ–å¤åˆ¶é¡¹ç›®
git clone <your-repo>
cd yishe-images

# 3. æ„å»ºé•œåƒï¼ˆåªéœ€ä¸€æ¬¡ï¼Œæˆ–ä»£ç æ›´æ–°æ—¶ï¼‰
docker-compose build

# 4. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 5. è®¿é—®æœåŠ¡
# æµè§ˆå™¨æ‰“å¼€: http://localhost:1513

# 6. æŸ¥çœ‹æ—¥å¿—ï¼ˆå¦‚æœéœ€è¦ï¼‰
docker-compose logs -f

# 7. åœæ­¢æœåŠ¡
docker-compose down
```

---

## ğŸ¯ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆé•œåƒè¿™ä¹ˆå¤§ï¼Ÿ

**A:** é•œåƒåŒ…å«äº† Node.jsã€ImageMagick å’Œæ‰€æœ‰ä¾èµ–ã€‚
- å¯ä»¥ä½¿ç”¨ `docker images` æŸ¥çœ‹å¤§å°
- ä½¿ç”¨ `slim` ç‰ˆæœ¬å¯ä»¥å‡å°ä½“ç§¯

### Q2: å¦‚ä½•æ›´æ–°ä»£ç ï¼Ÿ

**A:** 
```bash
# æ–¹æ³•ä¸€ï¼šé‡æ–°æ„å»º
docker-compose down
docker-compose build --no-cache
docker-compose up -d

# æ–¹æ³•äºŒï¼šä½¿ç”¨æ•°æ®å·æŒ‚è½½ä»£ç ï¼ˆå¼€å‘æ—¶ï¼‰
# ä¿®æ”¹ docker-compose.ymlï¼Œæ·»åŠ ä»£ç ç›®å½•æŒ‚è½½
```

### Q3: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ

**A:**
```bash
# å¤‡ä»½ uploads å’Œ output ç›®å½•
tar -czf backup.tar.gz uploads/ output/

# æ¢å¤
tar -xzf backup.tar.gz
```

### Q4: å¤šä¸ªå®¹å™¨å¯ä»¥åŒæ—¶è¿è¡Œå—ï¼Ÿ

**A:** å¯ä»¥ï¼Œä½†éœ€è¦ä¿®æ”¹ç«¯å£æ˜ å°„ï¼š
```yaml
ports:
  - "1513:1513"  # ç¬¬ä¸€ä¸ªå®¹å™¨
  - "1514:1513"  # ç¬¬äºŒä¸ªå®¹å™¨ï¼ˆä¸åŒå®¿ä¸»æœºç«¯å£ï¼‰
```

---

## ğŸ“– å­¦ä¹ èµ„æº

- **Docker å®˜æ–¹æ–‡æ¡£**: https://docs.docker.com/
- **Docker Compose æ–‡æ¡£**: https://docs.docker.com/compose/
- **Node.js Docker æœ€ä½³å®è·µ**: https://nodejs.org/en/docs/guides/nodejs-docker-webapp/

---

## âœ… æ£€æŸ¥æ¸…å•

ä½¿ç”¨ Docker å‰ï¼Œç¡®ä¿ï¼š

- [ ] Docker å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] ç«¯å£ 1513 æœªè¢«å ç”¨
- [ ] æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘ 2GBï¼‰
- [ ] æœ‰ç½‘ç»œè¿æ¥ï¼ˆä¸‹è½½é•œåƒéœ€è¦ï¼‰

---

**ç°åœ¨ä½ å·²ç»äº†è§£äº† Docker çš„åŸºæœ¬æ¦‚å¿µï¼å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼** ğŸ‰

